---
title: HTTP协议概述
date: 2020-08-16 13:29:14
tags: 
  - http
categories: 
  - 计算机网络
---

# HTTP协议概述

## 1. 前言

HTTP协议并不是什么高深的协议，相反正式因为HTTP协议足够简单所以它才会被广泛的使用。

## 2. 什么是协议

很多人不理解http协议其实是因为不理解`协议`或者说是自己将协议复杂化。其实协议很简单，就是一个约定。

**举个例子**

在你的电脑上有许多文件`1.txt 2.txt 3.txt ...`, 现在我想通过互联网来从你的电脑上获取这些文件。为了完成这一目的我们需要以下几步

1. 首先我需要在互联网上和你的电脑建立连接，为了保证传输的稳定性我们选择使用TCP协议（不理解TCP协议的同学，先简单的理解为负责传输我们数据的一种方式）来建立我们的连接。

2. 建立连接后我发消息告诉你我想要的文件，你接收到我的消息后将对应的文件发送给我。

   - 这时就有一些问题，你的程序处理我发送消息是死板的，比如我发送`给我1.txt`和`把 1.txt 给我`对我来说都是一样的目的，但是你的程序解读时是不一样的。

   - 为了解决这个问题我们必须统一我发送请求的格式，这样你的程序解读时就比较方便，因为有了固定的格式

     比如我们约定如果我想获取你电脑上的文件我发送的请求格式就必须为`GET 文件名 \r\n`, 其中`GET`代表你这次的请求目的是`获取`，然后空一格写上你想要的文件名，最后用`\r\n` 代表请求结束

   - 有了这种统一的约定就会很方便的实现一些功能

我们上面举的例子中的`约定`就是所谓的`协议`



## 什么是HTTP协议

HTTP的全称是`HyperText Transfer Protocol`中文叫做超文本传输协议，所谓的超文本其实就是`HTML`文件，把上面例子中的`txt文件`换成`html`文件，那么那就是HTTP的第一个版本(HTTP/0.9)，http是c/s模式的，从上面的例子我们可以看出`我`扮演的就是客户端,`你`扮演的就是服务端。其实随着http协议的发展其可以传送的文件类型几乎可以是任何类型

**为什么要叫html文件为超文本**

因为html文件里可以包含超链接（就是URL，他只是字符串，不要理解为超链接有特殊功能，哪些跳转功能都是浏览器实现的），它指向了网络中另外一处的资源，这样html可以组织互联网中的资源，可能是这样比较高级吧所以发明者称之为`超文本`。

## HTTP/1.1

`http/1.1`是http版本的一种，是标准化的协议，发布于1997年，时至今日`http/1.1`仍然是使用最广泛的协议。

在`HTTP/1.0`的时候引入了请求头的概念，我们可以通过设置请求头可能很方便的对HTTP协议进行拓展。

### 请求格式

http协议定义的请求格式由4个部分组成，分别是`请求行`，`请求头`，`空行`，`请求体`

- 请求行

  指定请求的方法，路径，协议版本

- 请求头

  以键值对的方式设置一些需要告诉服务端的其他信息，比如`User-Agent: Firefox`代表你的用户代理是Firefox

- 空行

  就是普通的空行，分割上面的头部和下面的请求体

- 请求体

  像`POST`这类方法需要发送而外的请求信息就会把要发送的数据放在请求体中

### 响应例子

http协议定义的响应格式同请求格式类似，也是由四个部分组成：`响应行`，`响应头`，`空行`，`响应体`

- 响应行

  http的版本，响应状态码，响应信息

- 响应头

  以键值对的方式设置一些需要告诉客户端的其他信息，比如：`Content-Type: text/html`代表传给你的文件类型是html

- 空行

  就是普通的空行，分割上面的头部和下面的响应体

- 响应体

  客户端请求的数据将会放在响应体中返回

**举个例子**

为了更好的阅读，在下面我会将`\r\n`（回车换行符）用折行来显示，比如

`aaaaa \r\n bbb`

显示为

```
aaaaa
bbb
```

>```
>GET /en-US/docs/Glossary/Simple_header HTTP/1.1
>Host: developer.mozilla.org
>User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.9; rv:50.0) Gecko/20100101 Firefox/50.0
>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
>Accept-Language: en-US,en;q=0.5
>Accept-Encoding: gzip, deflate, br
>Referer: https://developer.mozilla.org/en-US/docs/Glossary/Simple_header
>
>HTTP/1.1 200 OK
>Connection: Keep-Alive
>Content-Encoding: gzip
>Content-Type: text/html; charset=utf-8
>Date: Wed, 20 Jul 2016 10:55:30 GMT
>Etag: "547fa7e369ef56031dd3bff2ace9fc0832eb251a"
>Keep-Alive: timeout=5, max=1000
>Last-Modified: Tue, 19 Jul 2016 00:59:33 GMT
>Server: Apache
>Transfer-Encoding: chunked
>Vary: Cookie, Accept-Encoding
>
>(content)
>```

  **解读**

- 请求部分

> ```
> GET /en-US/docs/Glossary/Simple_header HTTP/1.1
> ```
>
> GET方法
>
> 请求地址：/en-US/docs/Glossary/Simple_header
>
> HTTP版本：HTTP/1.1

> ```
> Host: developer.mozilla.org
> User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.9; rv:50.0) Gecko/20100101 Firefox/50.0
> Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
> Accept-Language: en-US,en;q=0.5
> Accept-Encoding: gzip, deflate, br
> Referer: https://developer.mozilla.org/en-US/docs/Glossary/Simple_header
> ```
>
> 请求头部分，数据以键值对的方式存放，请求头中的key种类繁多，每种请求按需取用，这里代表的意思是
>
> 请求主机: developer.mozilla.org
>
> 用户代理（你是谁）：Mozilla/5.0 (Macintosh; Intel Mac OS X 10.9; rv:50.0) Gecko/20100101 Firefox/50.0
>
> 接受的类型（这个类型展开又可以讲很多）：text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
>
> 接受的自然语言：en-US,en;q=0.5
>
> 接受的编码方式：gzip, deflate, br
>
> 从哪里跳转过来：https://developer.mozilla.org/en-US/docs/Glossary/Simple_header

> 由于这里GET请求没有没有携带而外参数，所以就没有请求体

- 响应部分

> ```
> HTTP/1.1 200 OK
> ```
>
> HTTP协议：HTTP/1.1
>
> 响应状态码: 200
>
> 响应状态描述: OK

> ```
> Connection: Keep-Alive
> Content-Encoding: gzip
> Content-Type: text/html; charset=utf-8
> Date: Wed, 20 Jul 2016 10:55:30 GMT
> Etag: "547fa7e369ef56031dd3bff2ace9fc0832eb251a"
> Keep-Alive: timeout=5, max=1000
> Last-Modified: Tue, 19 Jul 2016 00:59:33 GMT
> Server: Apache
> Transfer-Encoding: chunked
> Vary: Cookie, Accept-Encoding
> ```
>
> 响应头

> ```
> 
> ```
>
> 空行

> ```
> (content)
> ```
>
> 响应体内容

## HTTP的特点

### 简单

http是比较简单的应用层协议，通过一些列请求方法来区分不同功能的请求，通过URL来在互联网上定位资源，通过头部来携带一些其他数据，通过Body来携带数据，而且HTTP/1.1及其之前的数据报都是可以阅读的。

### 可拓展

由于HTTP/1.0开始引入了头部概念，所以我们可以通过添加自己的头部信息来实现自定义的功能。

### 无状态，有会话的

从上面的例子可以看出每一次请求之间都是孤立的没有联系的，也就是说HTTP请求是无状态的，这就带来了一个问题，用户没有办法在同一个网站中进行连续的交互，比如在一个电商网站里，用户把某个商品加入到购物车，切换一个页面后再次添加了商品，这两次添加商品的请求之间没有关联，浏览器无法知道用户最终选择了哪些商品。为了解决这个问题，我们可以在头部加一个字段本质上取名可以任意，但是为了统一我们将这个字段的名称取为`Cookies`，我们把商品信息加入到这个字段中，然后每次请求都带上`Cookies`这个字段就实现了有状态的会话。

## HTTP/1.x的缺点

HTTP是传输层上的应用层协议，最常见的传输层协议有两种`UDP`，`TCP`为了稳定起见，HTTP选择了TCP协议。但是建立TCP比较耗时，而且通常一个网页会同时会发起多个HTTP请求，由于HTTP/1.x不能复用一个TCP连接所以每个HTTP请求都会单独开一个TCP连接，这将非常低效。为了减轻这些缺陷，HTTP/1.1引入了流水线（被证明难以实现）和持久连接的概念：底层的TCP连接可以通过Connection头部来被部分控制。HTTP/2则发展得更远，通过在一个连接复用消息的方式来让这个连接始终保持为暖连接。 